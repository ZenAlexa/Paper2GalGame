/**\n * Enhanced Paper Parser Type Definitions - 2026 Edition\n *\n * Advanced types for modern multimodal AI-powered paper parsing\n * with professional formula recognition and layout understanding.\n */\n\nimport type { \n  Equation, \n  Figure, \n  Table, \n  PaperSection, \n  ParsedPaper, \n  ParseResult,\n  ParserConfig,\n  ParsingStats \n} from './paper';\n\n/**\n * Enhanced equation with AI-powered analysis\n */\nexport interface EnhancedEquation extends Equation {\n  /** Normalized bounding box coordinates [x1, y1, x2, y2] (0-1) */\n  bbox?: [number, number, number, number];\n  \n  /** AI recognition confidence score (0-1) */\n  confidence: number;\n  \n  /** Semantic description of the equation's meaning */\n  semanticDescription?: string;\n  \n  /** Contextual information from surrounding text */\n  context?: string;\n  \n  /** Mathematical complexity assessment */\n  complexity: 'simple' | 'medium' | 'complex';\n  \n  /** Type of mathematics involved */\n  mathType: 'arithmetic' | 'algebra' | 'calculus' | 'statistics' | 'geometry' | 'logic' | 'other';\n  \n  /** Original formula image (base64 encoded PNG) */\n  visualImage?: string;\n  \n  /** AI processing metadata */\n  aiMetadata?: {\n    /** AI model used for recognition */\n    model: string;\n    /** Processing time in milliseconds */\n    processingTime: number;\n    /** Alternative LaTeX representations */\n    alternatives?: string[];\n    /** Recognition method used */\n    method: 'structural' | 'visual' | 'hybrid';\n    /** Quality assessment */\n    quality: {\n      latexAccuracy: number;      // 0-1\n      semanticRelevance: number;  // 0-1\n      contextAlignment: number;   // 0-1\n    };\n  };\n  \n  /** Educational annotations for galgame use */\n  educational?: {\n    /** Difficulty level for learning */\n    difficulty: 'beginner' | 'intermediate' | 'advanced';\n    /** Key concepts involved */\n    concepts: string[];\n    /** Suggested explanation approach */\n    explanation?: string;\n  };\n}\n\n/**\n * Enhanced figure with layout and AI analysis\n */\nexport interface EnhancedFigure extends Figure {\n  /** Normalized bounding box coordinates */\n  bbox?: [number, number, number, number];\n  \n  /** AI-generated detailed description */\n  aiDescription?: string;\n  \n  /** Detected elements within the figure */\n  elements?: {\n    /** Text elements (OCR) */\n    textRegions: Array<{\n      text: string;\n      bbox: [number, number, number, number];\n      confidence: number;\n    }>;\n    /** Mathematical elements */\n    mathRegions: Array<{\n      latex: string;\n      bbox: [number, number, number, number];\n      confidence: number;\n    }>;\n  };\n  \n  /** Educational value assessment */\n  educational?: {\n    relevance: number;    // 0-1\n    explanation?: string;\n    keyPoints: string[];\n  };\n}\n\n/**\n * Enhanced table with structure analysis\n */\nexport interface EnhancedTable extends Table {\n  /** Normalized bounding box coordinates */\n  bbox?: [number, number, number, number];\n  \n  /** AI understanding of table structure */\n  structure?: {\n    /** Column types detected */\n    columnTypes: ('text' | 'number' | 'formula' | 'mixed')[];\n    /** Data patterns identified */\n    patterns: string[];\n    /** Statistical summary if applicable */\n    summary?: string;\n  };\n  \n  /** Enhanced cell data with metadata */\n  enhancedCells?: Array<Array<{\n    content: string;\n    type: 'text' | 'number' | 'formula' | 'empty';\n    latex?: string;  // If cell contains formula\n    confidence: number;\n  }>>;\n}\n\n/**\n * Enhanced paper section with AI analysis\n */\nexport interface EnhancedPaperSection extends Omit<PaperSection, 'equations' | 'figures' | 'tables'> {\n  /** Enhanced equations in this section */\n  equations?: EnhancedEquation[];\n  \n  /** Enhanced figures in this section */\n  figures?: EnhancedFigure[];\n  \n  /** Enhanced tables in this section */\n  tables?: EnhancedTable[];\n  \n  /** AI-generated section summary */\n  aiSummary?: string;\n  \n  /** Key concepts identified in this section */\n  keyConcepts?: string[];\n  \n  /** Educational importance score */\n  educationalValue?: number; // 0-1\n  \n  /** Recommended teaching approach */\n  teachingNotes?: {\n    approach: 'conceptual' | 'practical' | 'mathematical' | 'mixed';\n    prerequisites: string[];\n    learningObjectives: string[];\n    suggestedExamples: string[];\n  };\n}\n\n/**\n * Enhanced parsing statistics with AI metrics\n */\nexport interface EnhancedParsingStats extends ParsingStats {\n  /** AI processing statistics */\n  aiProcessing: {\n    /** Total API calls made */\n    apiCalls: number;\n    /** Total AI processing time */\n    aiProcessingTimeMs: number;\n    /** Cost estimation */\n    estimatedCost: number;\n    /** AI models used */\n    modelsUsed: string[];\n    /** Overall AI confidence */\n    overallAiConfidence: number; // 0-1\n  };\n  \n  /** Quality metrics */\n  quality: {\n    /** Formula recognition accuracy estimate */\n    formulaAccuracy: number;     // 0-1\n    /** Layout detection accuracy */\n    layoutAccuracy: number;      // 0-1\n    /** Structure classification accuracy */\n    structureAccuracy: number;   // 0-1\n  };\n  \n  /** Method used for processing */\n  processingMethod: 'legacy' | 'mineru' | 'hybrid' | 'ai-only';\n}\n\n/**\n * Enhanced parsed paper with AI enrichment\n */\nexport interface EnhancedParsedPaper extends Omit<ParsedPaper, 'sections' | 'stats'> {\n  /** Enhanced sections with AI analysis */\n  sections: EnhancedPaperSection[];\n  \n  /** Enhanced statistics */\n  stats: EnhancedParsingStats;\n  \n  /** Overall paper analysis */\n  analysis?: {\n    /** Academic field classification */\n    field: string;\n    /** Complexity assessment */\n    complexity: 'undergraduate' | 'graduate' | 'research' | 'expert';\n    /** Key mathematical concepts */\n    mathConcepts: string[];\n    /** Recommended character assignments for galgame */\n    characterSuggestions: Array<{\n      character: string;\n      role: 'presenter' | 'questioner' | 'explainer' | 'challenger';\n      sections: string[];  // Section types this character should handle\n    }>;\n    /** Educational pathway */\n    learningPath: Array<{\n      step: number;\n      concept: string;\n      prerequisites: string[];\n      difficulty: number; // 1-10\n    }>;\n  };\n}\n\n/**\n * Enhanced parsing result with AI confidence\n */\nexport interface EnhancedParseResult extends Omit<ParseResult, 'data'> {\n  /** Enhanced paper data */\n  data?: EnhancedParsedPaper;\n  \n  /** AI processing summary */\n  aiSummary?: {\n    /** Processing method used */\n    method: 'legacy' | 'ai-enhanced' | 'full-ai';\n    /** Confidence in overall result */\n    confidence: number;\n    /** Recommendations for improvement */\n    recommendations: string[];\n    /** Cost breakdown */\n    costs: {\n      apiCalls: number;\n      estimatedDollars: number;\n      tokensUsed: number;\n    };\n  };\n}\n\n/**\n * Configuration for AI-enhanced parsing\n */\nexport interface EnhancedParserConfig extends ParserConfig {\n  /** AI enhancement settings */\n  aiEnhancement?: {\n    /** Enable AI-powered formula recognition */\n    enableFormulaAI: boolean;\n    \n    /** Enable layout analysis */\n    enableLayoutAnalysis: boolean;\n    \n    /** Enable semantic understanding */\n    enableSemanticAnalysis: boolean;\n    \n    /** Enable educational annotations */\n    enableEducationalAnalysis: boolean;\n    \n    /** Maximum formulas to process with AI (cost control) */\n    maxAIFormulas: number;\n    \n    /** Preferred AI models */\n    preferredModels: {\n      vision: string;      // e.g., 'google/gemini-3-flash-preview'\n      text: string;        // e.g., 'google/gemini-3-flash-preview' \n      fallback: string;    // e.g., 'openai/gpt-4o'\n    };\n    \n    /** Cost control */\n    costControl: {\n      maxCostPerPaper: number;    // Maximum cost in dollars\n      enableCaching: boolean;     // Enable result caching\n      fallbackToLegacy: boolean;  // Fall back if cost exceeded\n    };\n  };\n  \n  /** MinerU service configuration */\n  mineruConfig?: {\n    /** MinerU service endpoint */\n    serviceUrl: string;\n    \n    /** Enable MinerU for PDF processing */\n    enabled: boolean;\n    \n    /** Timeout for MinerU calls */\n    timeout: number;\n    \n    /** Fallback to legacy PDF parser if failed */\n    fallbackToLegacy: boolean;\n  };\n  \n  /** OpenRouter API configuration */\n  openRouterConfig?: {\n    /** API key */\n    apiKey: string;\n    \n    /** Base URL */\n    baseURL?: string;\n    \n    /** Request timeout */\n    timeout?: number;\n    \n    /** Rate limiting */\n    rateLimit?: {\n      requestsPerMinute: number;\n      burstLimit: number;\n    };\n  };\n}\n\n/**\n * Engine type for parsing\n */\nexport type ParsingEngine = 'auto' | 'legacy' | 'mineru' | 'ai-enhanced' | 'full-ai';\n\n/**\n * Result from engine detection/selection\n */\nexport interface EngineSelection {\n  /** Selected engine */\n  engine: ParsingEngine;\n  \n  /** Reason for selection */\n  reason: string;\n  \n  /** Confidence in selection */\n  confidence: number;\n  \n  /** Fallback engines available */\n  fallbacks: ParsingEngine[];\n}\n\n/**\n * Progress callback for long-running parsing\n */\nexport interface ParsingProgress {\n  /** Current stage */\n  stage: 'init' | 'pdf-extraction' | 'structure-analysis' | 'formula-processing' | 'ai-enhancement' | 'finalization';\n  \n  /** Progress percentage (0-100) */\n  progress: number;\n  \n  /** Current operation description */\n  description: string;\n  \n  /** Estimated remaining time in seconds */\n  estimatedRemainingSeconds?: number;\n  \n  /** Items processed vs total */\n  itemsProcessed?: {\n    current: number;\n    total: number;\n    type: 'pages' | 'formulas' | 'figures' | 'sections';\n  };\n}\n\n/**\n * Callback function type for progress updates\n */\nexport type ProgressCallback = (progress: ParsingProgress) => void;\n\n/**\n * Cache entry for parsed results\n */\nexport interface CacheEntry {\n  /** File hash */\n  fileHash: string;\n  \n  /** Parsing configuration used */\n  configHash: string;\n  \n  /** Cached result */\n  result: EnhancedParseResult;\n  \n  /** Cache timestamp */\n  timestamp: Date;\n  \n  /** Expiration time */\n  expiresAt: Date;\n  \n  /** Cache metadata */\n  metadata: {\n    fileSize: number;\n    processingTime: number;\n    aiCost: number;\n  };\n}\n\n/**\n * Validation result for parsed content\n */\nexport interface ValidationResult {\n  /** Overall validation passed */\n  valid: boolean;\n  \n  /** Validation score (0-1) */\n  score: number;\n  \n  /** Issues found */\n  issues: Array<{\n    type: 'warning' | 'error' | 'critical';\n    code: string;\n    message: string;\n    section?: string;\n    position?: number;\n    suggestion?: string;\n  }>;\n  \n  /** Quality metrics */\n  quality: {\n    formulaQuality: number;      // 0-1\n    structureQuality: number;    // 0-1\n    contentCompleteness: number; // 0-1\n    aiAccuracy: number;          // 0-1\n  };\n}\n"